# language: node_js
# node_js:
#   - 13

# services:
#   - docker

# # Pre-testing installs
# install:
#   - echo "nothing needs to be installed"

# # Scripts to be run such as tests
# before_script:
#   - echo "no tests"

# script:
#   - docker --version # print the version for logging
#   - docker image prune --all  --force
#   - docker-compose -f docker-compose-build.yaml build --parallel

#   # - docker build -t udagram-api-feed ./udagram-api-feed
#   - docker tag udagram-api-feed azumahjoshua/udagram-api-feed:v6

#   # - docker build -t udagram-api-user ./udagram-api-user
#   - docker tag udagram-api-user azumahjoshua/udagram-api-user:v6

#   # - docker build -t udagram-frontend ./udagram-frontend
#   - docker tag udagram-frontend:local azumahjoshua/udagram-frontend:v6

#   # - docker build -t reverseproxy  ./udagram-reverseproxy
#   - docker tag reverseproxy azumahjoshua/reverseproxy:v6

#   - docker images
#   # - docker-compose -f docker-compose-build-yaml build -parallel

# after_success:
#   - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
#   - docker push azumahjoshua/reverseproxy:v4
#   - docker push azumahjoshua/udagram-api-user:v6
#   - docker push azumahjoshua/udagram-api-feed:v6
#   - docker push azumahjoshua/udagram-frontend:v6

# This workflow will do a clean installation of node dependencies, cache/restore them, build the source code and run tests across different versions of node
# For more information see: https://docs.github.com/en/actions/automating-builds-and-tests/building-and-testing-nodejs

name: Node.js CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - run: echo "Starting-----"
    - run: docker image prune --all  --force
    - run: docker-compose -f docker-compose-build.yaml build --parallel
    - run: docker tag udagram-api-feed azumahjoshua/udagram-api-feed:v6
    - run: docker tag udagram-api-user azumahjoshua/udagram-api-user:v6
    - run: docker tag udagram-frontend:local azumahjoshua/udagram-frontend:v6
    - run: docker tag reverseproxy azumahjoshua/reverseproxy:v6
    - run: docker images
    - run: docker push azumahjoshua/reverseproxy:v6
    - run: docker push azumahjoshua/udagram-api-user:v6
    - run: docker push azumahjoshua/udagram-api-feed:v6
    - run: docker push azumahjoshua/udagram-frontend:v6
 